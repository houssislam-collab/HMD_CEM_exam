<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ù†Ùƒ Ø§Ù„ÙØ±ÙˆØ¶ - HMD</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap');
        body { font-family: 'Cairo', sans-serif; margin: 0; padding: 0; background-color: #0f172a; color: white; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .modal-enter { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBEcm3zu-Rje7qGFII2hFOD9my0-rYQhbA",
          authDomain: "hmd-exam-c09ce.firebaseapp.com",
          projectId: "hmd-exam-c09ce",
          storageBucket: "hmd-exam-c09ce.firebasestorage.app",
          messagingSenderId: "224558405314",
          appId: "1:224558405314:web:48ad7854c973e259000d5b"
        };

        const app = initializeApp(firebaseConfig);
        window.hmdDB = getFirestore(app);
        window.hmdStore = { collection, addDoc, onSnapshot, query, orderBy };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Icon = ({ name, cls = "" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={cls}></i>;
        };

        const App = () => {
            const [v, setV] = useState('home');
            const [lv, setLv] = useState(null);
            const [sub, setSub] = useState(null);
            const [typ, setTyp] = useState(null);
            const [allFiles, setAllFiles] = useState([]);
            const [openFileUrl, setOpenFileUrl] = useState(null);

            useEffect(() => {
                if (!window.hmdDB) return;
                const q = window.hmdStore.query(window.hmdStore.collection(window.hmdDB, "bank_files"), window.hmdStore.orderBy("date", "desc"));
                const unsub = window.hmdStore.onSnapshot(q, (snap) => {
                    const data = [];
                    snap.forEach(doc => data.push({id: doc.id, ...doc.data()}));
                    setAllFiles(data);
                });
                return () => unsub();
            }, []);

            const subjects = [
                { n: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', i: 'book-a', c: 'from-blue-500 to-blue-600', d: 'Ù‚ÙˆØ§Ø¹Ø¯ØŒ ØªØ¹Ø¨ÙŠØ±ØŒ Ø£Ø¯Ø¨' },
                { n: 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', i: 'calculator', c: 'from-purple-500 to-purple-600', d: 'Ø¬Ø¨Ø±ØŒ Ù‡Ù†Ø¯Ø³Ø©ØŒ Ø­Ø³Ø§Ø¨' },
                { n: 'Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©', i: 'flag', c: 'from-pink-500 to-pink-600', d: 'Ù‚ÙˆØ§Ø¹Ø¯ØŒ ØªØ¹Ø¨ÙŠØ±ØŒ Ù‚Ø±Ø§Ø¡Ø©' },
                { n: 'Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©', i: 'atom', c: 'from-green-500 to-green-600', d: 'ÙÙŠØ²ÙŠØ§Ø¡ ÙˆÙƒÙŠÙ…ÙŠØ§Ø¡' },
                { n: 'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©', i: 'book-open', c: 'from-emerald-500 to-emerald-600', d: 'Ù‚Ø±Ø¢Ù†ØŒ Ø­Ø¯ÙŠØ«ØŒ ÙÙ‚Ù‡' },
                { n: 'Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª', i: 'globe', c: 'from-orange-500 to-orange-600', d: 'ØªØ§Ø±ÙŠØ®ØŒ Ø¬ØºØ±Ø§ÙÙŠØ§' },
                { n: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©', i: 'languages', c: 'from-indigo-500 to-indigo-600', d: 'Ù‚ÙˆØ§Ø¹Ø¯ØŒ Ù…Ø­Ø§Ø¯Ø«Ø©' },
                { n: 'Ø§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù„ÙŠ', i: 'monitor', c: 'from-cyan-500 to-cyan-600', d: 'Ø¨Ø±Ù…Ø¬Ø©ØŒ Ø´Ø¨ÙƒØ§Øª' }
            ];

            const types = [
                { n: 'ÙØ±ÙˆØ¶ Ø§Ù„ÙØµÙ„ 1', i: 'file-edit', c: 'from-blue-500 to-indigo-600' },
                { n: 'ÙØ±ÙˆØ¶ Ø§Ù„ÙØµÙ„ 2', i: 'file-edit', c: 'from-purple-500 to-pink-600' },
                { n: 'ÙØ±ÙˆØ¶ Ø§Ù„ÙØµÙ„ 3', i: 'file-edit', c: 'from-orange-500 to-red-600' },
                { n: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª', i: 'clipboard-check', c: 'from-green-500 to-emerald-600' },
                { n: 'Ø§Ù„Ù…Ù„Ø®ØµØ§Øª', i: 'book-marked', c: 'from-amber-500 to-orange-600' },
                { n: 'Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†', i: 'pen-tool', c: 'from-cyan-500 to-blue-600' }
            ];

            const formatDriveUrl = (url, type) => {
                let fileId = "";
                if (url.includes("/d/")) fileId = url.split("/d/")[1].split("/")[0];
                else if (url.includes("id=")) fileId = url.split("id=")[1].split("&")[0];
                return type === 'preview' ? `https://drive.google.com/file/d/${fileId}/preview` : `https://drive.google.com/uc?export=download&id=${fileId}`;
            };

            const addFile = async (e) => {
                e.preventDefault();
                const form = e.target;
                await window.hmdStore.addDoc(window.hmdStore.collection(window.hmdDB, "bank_files"), {
                    name: form.fname.value, url: form.furl.value, lvl: form.flvl.value, sub: form.fsub.value, typ: form.ftyp.value, date: new Date()
                });
                alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­!"); form.reset();
            };

            if (v === 'admin') return (
                <div className="min-h-screen p-6 flex items-center justify-center">
                    <div className="glass max-w-md w-full p-8 rounded-[40px]">
                        <button onClick={() => setV('home')} className="text-gray-400 mb-4">â† Ø¹ÙˆØ¯Ø©</button>
                        <h2 className="text-2xl font-black mb-6 text-center italic">Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª HMD</h2>
                        <form onSubmit={addFile} className="space-y-4">
                            <input name="fname" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù" className="w-full p-4 bg-slate-800 rounded-2xl border border-white/5 text-white" required />
                            <input name="furl" placeholder="Ø±Ø§Ø¨Ø· Google Drive" className="w-full p-4 bg-slate-800 rounded-2xl border border-white/5 text-white" required />
                            <select name="flvl" className="w-full p-4 bg-slate-800 rounded-2xl text-white">
                                {['1', '2', '3', '4', 'BEM'].map(l => <option key={l} value={l}>{l === 'BEM' ? 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ù…ØªÙˆØ³Ø·' : l + ' Ù…ØªÙˆØ³Ø·'}</option>)}
                            </select>
                            <select name="fsub" className="w-full p-4 bg-slate-800 rounded-2xl text-white">
                                {subjects.map(s => <option key={s.n} value={s.n}>{s.n}</option>)}
                            </select>
                            <select name="ftyp" className="w-full p-4 bg-slate-800 rounded-2xl text-white">
                                {types.map(t => <option key={t.n} value={t.n}>{t.n}</option>)}
                            </select>
                            <button className="w-full bg-indigo-600 py-4 rounded-2xl font-black">Ø­ÙØ¸ ÙˆÙ†Ø´Ø±</button>
                        </form>
                    </div>
                </div>
            );

            if (v === 'home') return (
                <div className="min-h-screen p-4 md:p-6 bg-gradient-to-br from-slate-900 via-indigo-900 to-purple-900">
                    <div className="max-w-7xl mx-auto pt-12 text-center">
                        <div className="inline-block glass rounded-full px-6 py-2 mb-6 cursor-pointer" onClick={() => setV('admin')}>
                            <span className="text-purple-300 text-sm font-semibold">ğŸ“š Ø¨Ù†Ùƒ Ø§Ù„ÙØ±ÙˆØ¶ ÙˆØ§Ù„Ø¯Ø±ÙˆØ³ - HMD</span>
                        </div>
                        <h1 className="text-5xl md:text-7xl font-black bg-gradient-to-r from-pink-400 via-purple-400 to-indigo-400 bg-clip-text text-transparent mb-12 italic tracking-tighter">
                            ØªÙÙˆÙ‘Ù‚Ùƒ ÙŠØ¨Ø¯Ø£ Ù…Ù† Ù‡Ù†Ø§
                        </h1>

                        <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 max-w-5xl mx-auto mb-16">
                            {[
                                { l: 'Ø·Ø§Ù„Ø¨ Ù…Ø³ØªÙÙŠØ¯', v: '+5K', i: 'users', c: 'bg-orange-500' },
                                { l: 'ØªØ­Ù…ÙŠÙ„ Ø´Ù‡Ø±ÙŠ', v: '+10K', i: 'download', c: 'bg-green-500' },
                                { l: 'Ù…Ø§Ø¯Ø© Ø¯Ø±Ø§Ø³ÙŠØ©', v: '8', i: 'book', c: 'bg-pink-500' },
                                { l: 'Ù…Ù„Ù Ù…ØªØ§Ø­', v: allFiles.length > 0 ? `+${allFiles.length}` : '500+', i: 'files', c: 'bg-blue-500' }
                            ].map((s, i) => (
                                <div key={i} className="glass p-6 rounded-[30px] border border-white/10 group">
                                    <div className={`${s.c} w-10 h-10 rounded-xl flex items-center justify-center mx-auto mb-4`}>
                                        <Icon name={s.i} cls="w-5 h-5 text-white" />
                                    </div>
                                    <div className="text-3xl font-black text-white mb-1 tracking-tighter">{s.v}</div>
                                    <div className="text-gray-400 text-xs font-bold uppercase">{s.l}</div>
                                </div>
                            ))}
                        </div>

                        <h2 className="text-2xl font-bold mb-8 text-white">Ø§Ø®ØªØ± Ø³Ù†ØªÙƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h2>
                        <div className="grid grid-cols-2 md:grid-cols-5 gap-4 max-w-7xl mx-auto">
                            {['1', '2', '3', '4', 'BEM'].map((l) => (
                                <button key={l} onClick={() => { setLv(l); setV('subjects'); }}
                                    className={`glass p-8 rounded-[40px] transition-all transform hover:-translate-y-2 group ${l === 'BEM' ? 'border-yellow-500/50 bg-yellow-500/10' : 'hover:border-purple-400'}`}>
                                    <div className={`${l === 'BEM' ? 'bg-gradient-to-tr from-yellow-500 to-red-600' : 'bg-gradient-to-tr from-purple-600 to-pink-500'} w-14 h-14 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-xl group-hover:rotate-6 transition-transform`}>
                                        <Icon name={l === 'BEM' ? 'award' : 'graduation-cap'} cls="w-8 h-8 text-white" />
                                    </div>
                                    <div className="text-xl font-bold italic text-white">{l === 'BEM' ? 'BEM' : `Ø§Ù„Ø³Ù†Ø© ${l}`}</div>
                                    <div className="text-purple-300 text-[10px] font-bold uppercase">{l === 'BEM' ? 'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ù…ØªÙˆØ³Ø·' : 'Ù…ØªÙˆØ³Ø·'}</div>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );

            if (v === 'subjects') return (
                <div className="min-h-screen p-6 bg-gradient-to-br from-slate-900 to-purple-900">
                    <div className="max-w-6xl mx-auto">
                        <button onClick={() => setV('home')} className="glass px-6 py-2 rounded-2xl mb-8 flex items-center gap-2 text-white">â† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                        <h1 className="text-4xl font-black mb-10 text-center text-white">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© - {lv === 'BEM' ? 'Ø´Ù‡Ø§Ø¯Ø© BEM' : `Ø§Ù„Ø³Ù†Ø© ${lv}`}</h1>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-5">
                            {subjects.map((s, i) => (
                                <button key={i} onClick={() => { setSub(s); setV('types'); }}
                                    className="glass p-6 rounded-[35px] hover:border-blue-400 transition-all text-center group">
                                    <div className={`bg-gradient-to-br ${s.c} w-16 h-16 rounded-3xl flex items-center justify-center mx-auto mb-4 shadow-xl group-hover:scale-110 transition-transform`}>
                                        <Icon name={s.i} cls="w-8 h-8 text-white" />
                                    </div>
                                    <h3 className="font-bold text-lg mb-1 text-white">{s.n}</h3>
                                    <p className="text-gray-400 text-[10px]">{s.d}</p>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );

            if (v === 'types') return (
                <div className="min-h-screen p-6 bg-gradient-to-br from-slate-900 to-blue-900 text-center">
                    <div className="max-w-5xl mx-auto">
                        <button onClick={() => setV('subjects')} className="glass px-6 py-2 rounded-2xl mb-8 text-white">â† Ø±Ø¬ÙˆØ¹</button>
                        <h1 className="text-4xl font-black mb-10 italic text-white">Ù…Ø§Ø°Ø§ ØªØ¨Ø­Ø« ÙÙŠ {sub?.n}ØŸ</h1>
                        <div className="grid md:grid-cols-3 gap-6">
                            {types.map((t, i) => (
                                <button key={i} onClick={() => { setTyp(t); setV('files'); }}
                                    className="glass p-8 rounded-[40px] hover:border-cyan-400 transition-all transform hover:scale-105">
                                    <div className={`bg-gradient-to-tr ${t.c} w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-xl`}>
                                        <Icon name={t.i} cls="w-8 h-8 text-white" />
                                    </div>
                                    <h3 className="text-xl font-black text-white">{t.n}</h3>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );

            const currentFiles = allFiles.filter(f => f.lvl === lv && f.sub === sub?.n && f.typ === typ?.n);

            return (
                <div className="min-h-screen p-6 bg-slate-900 text-white">
                    {openFileUrl && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/95 p-4">
                            <div className="glass w-full h-full max-w-5xl rounded-[40px] overflow-hidden flex flex-col modal-enter">
                                <div className="p-4 flex justify-between items-center border-b border-white/10">
                                    <span className="font-bold">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù</span>
                                    <button onClick={() => setOpenFileUrl(null)} className="bg-red-500/20 text-red-500 p-2 rounded-xl">Ø¥ØºÙ„Ø§Ù‚</button>
                                </div>
                                <iframe src={openFileUrl} className="w-full flex-grow border-none"></iframe>
                            </div>
                        </div>
                    )}
                    <div className="max-w-4xl mx-auto">
                        <button onClick={() => setV('types')} className="glass px-6 py-2 rounded-2xl mb-8">â† Ø±Ø¬ÙˆØ¹</button>
                        <div className="glass p-8 rounded-[40px] mb-8 flex justify-between items-center">
                            <div>
                                <h1 className="text-3xl font-black">{typ?.n}</h1>
                                <p className="text-gray-400">{sub?.n} - {lv === 'BEM' ? 'Ø´Ù‡Ø§Ø¯Ø© BEM' : `Ø§Ù„Ø³Ù†Ø© ${lv} Ù…ØªÙˆØ³Ø·`}</p>
                            </div>
                            <div className="bg-white/5 p-4 rounded-3xl border border-white/10 text-center min-w-[100px]">
                                <span className="text-2xl font-black block">{currentFiles.length}</span>
                                <span className="text-[10px] text-gray-500 font-bold uppercase">Ù…Ù„Ù</span>
                            </div>
                        </div>
                        <div className="space-y-4">
                            {currentFiles.length === 0 ? <p className="text-center py-10 text-gray-500 italic">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø±ÙÙˆØ¹Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p> :
                                currentFiles.map(f => (
                                    <div key={f.id} className="glass p-6 rounded-[30px] flex justify-between items-center gap-4 hover:border-green-500/50 transition-all">
                                        <div className="flex items-center gap-4">
                                            <div className="bg-red-500/20 p-3 rounded-xl"><Icon name="file-text" cls="w-6 h-6 text-red-500" /></div>
                                            <h3 className="font-bold text-lg">{f.name}</h3>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => setOpenFileUrl(formatDriveUrl(f.url, 'preview'))} className="bg-white/5 p-3 rounded-xl hover:bg-white/10"><Icon name="eye" /></button>
                                            <button onClick={() => window.open(formatDriveUrl(f.url, 'download'), '_blank')} className="bg-green-600 p-3 rounded-xl shadow-lg"><Icon name="download" /></button>
                                        </div>
                                    </div>
                                ))
                            }
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
